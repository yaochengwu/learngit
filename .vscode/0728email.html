<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="0809email.css" />
    <script src="main.js"></script>
</head>

<body>
    <div class="wrapper">
        <input id="email-input" type="text">
        <ul id="email-sug-wrapper" class="email-sug"></ul>
        <p></p>
    </div>

    <script>
        var postfixList = ['163.com', 'gmail.com', '126.com', 'qq.com', '263.net'];
        var inp = document.getElementById("email-input");
        var list = document.getElementById("email-sug-wrapper");

        inp.oninput = function inputDom() {
            out();
            hs();
        }

        function inpv() {
            var inpval = inp.value;
            inpval = inpval.replace(/\s/g, ""); //去空格
            inpval = inpval.replace(/&/g, "&");
            inpval = inpval.replace(/</g, "<");
            inpval = inpval.replace(/>/g, ">");
            inpval = inpval.replace(/ /g, " ");
            inpval = inpval.replace(/\'/g, "'");
            inpval = inpval.replace(/\"/g, ""); //转义(/\"/g, """)没法显示，无解啊
            return inpval;
        }

        function out() {
            var val = inpv();
            list.innerHTML = "";

            if (val.indexOf("@") != -1) {
                var mval = val.slice(val.indexOf("@") + 1);
                val = val.slice(0, val.indexOf("@"));

                for (i = 0; i < postfixList.length; i++) {
                    var post = postfixList[i];
                    if (post.indexOf(mval) == 0) {
                        addlist();

                    }
                }
                if (list.innerHTML = "") {
                    for (i = 0; i < postfixList.length; i++) {
                        addlist();
                    }
                }


            } else {
                for (i = 0; i < postfixList.length; i++) {
                    addlist();
                }
            }

            function addlist() {
                val = val.replace(/&/g, "&");
                val = val.replace(/</g, "<");
                val = val.replace(/>/g, ">");
                val = val.replace(/ /g, " ");
                val = val.replace(/'/g, "\'");
                val = val.replace(/"/g, "\""); //解码,到底解了没有啊，愁人
                var nval = val + "@" + postfixList[i];
                var addli = document.createElement("li");
                var addnode = document.createTextNode(nval);
                addli.appendChild(addnode);
                list.appendChild(addli);
            }


        }

        function hs() {
            var val = inpv();
            if (val != "") {
                show();
            } else {
                hidd();
            }
        }

        function hidd() {
            list.style.display = "none";
        }

        function show() {

            list.style.display = "block";
        }
        //选择事件
        list.addEventListener("mouseover", chalist);
        list.addEventListener("mouseout", relist);
        list.addEventListener("click", choselist);

        function chalist(e) {
            var t = e.target || e.srcElement;
            if (t.nodeName.toLowerCase() == "li") {
                t.style.backgroundColor = "gray";
            }
        }

        function relist(e) {
            var t = e.target || e.srcElement;
            if (t.nodeName.toLowerCase() == "li") {
                t.style.backgroundColor = "white";
            }
        }

        function choselist(e) {
            var t = e.target || e.srcElement;
            if (t.nodeName.toLowerCase() == "li") {
                inp.value = t.innerHTML;
                hidd();
            }
        }
    </script>
</body>

</html>